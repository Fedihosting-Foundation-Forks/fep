---
slug: "7952"
authors: Dmitri Zagidulin <@dmitri@social.coop>, bumblefudge <bumblefudge@learningproof.xyz>
status: DRAFT
dateReceived: 2024-06-20
discussionTo: https://socialhub.activitypub.rocks/t/fep-7952-roadmap-for-actor-and-object-portability/4332/
---
# FEP-7952: Roadmap For Actor and Object Portability

## Summary

**Portability**: A set of design choices, data models, and protocols, that
enable an end-user to automatically migrate from one service provider to another
_with the least amount of data loss and service disruption_, including the user's
social graph (Followers and Following collections, etc).

We focus on _automated_ migration because the option of extremely manual migration
always exists, such as re-typing all of one's messages and content, manually
re-adding everyone to one's following collection, manually contacting everyone
on one's former followers list and asking them to re-follow, and so on.
However, that's an extreme failure state; we want to avoid that.

This FEP targets two main categories of migration, covering user stories 1A-1F
and 2+3 in [FEP-73cd: User Migration Stories][FEP-73cd], respectively.
It also draws inspiration from an earlier information document, 
[FEP-cd47: Federation-friendly Addressing and Deduplication Use-Cases][FEP-cd47].

### Migration from a live (cooperating) server

Note that the data handling and formatting recommendations made here will be
strictly complementary to the in-progress [LOLA
proposal](https://swicg.github.io/activitypub-data-portability/lola.html),
which target the same user stories.

### Migration via backup/export produced by a dead (or non-cooperating) server

### Current Approaches

Most current Fediverse implementations tend to follow a pattern of comprehensive
service providers (**instances**) that bundle the following concerns into a
single service running on a web domain:

1. Identity hosting (hosting of the Actor profile object, which serves as the
   source of truth for all others in the list)
2. Authentication and authorship/provenance of objects
3. Key management (used for HTTP Signatures for Server to Server request authentication)
4. ActivityPub Object and Collection storage (typically in a database)
5. Message Transfer Services (hosting of inboxes and outboxes, delivering of
   outgoing objects, notifications, etc)
6. Instance-based content moderation
7. Community discovery (via the instance's Local feed)
8. Front-end clients, i.e. “website” and/or mobile app (most current
   implementations bundle the backend system with a made-for-purpose front end
   that runs off the same server)

This tight coupling of concerns makes automated migration extremely limited
when migrating from a live server, and impossible when migrating from a dead one.

For example, a typical current Move Actor implementation (such as the one
[implemented by Mastodon](https://docs.joinmastodon.org/spec/activitypub/#Move),
or specified in [FEP-7628](https://codeberg.org/fediverse/fep/src/branch/main/fep/7628/fep-7628.md))
only assists the user with automatically migrating their Followers list (by
setting up a bi-directional `alsoKnownAs` links and sending the `Move` activity
to all of their followers). In addition, some implementations allow the manual
export and re-import of the Following lists, mutes, blocks and bookmarks.
However, important content like posts, media attachments, reactions, reposts and
so on, does not get automatically transferred.

This FEP proposes a roadmap (a set of steps, design concepts, and recommendations)
that enables more complete live migrations, as well as enabling migrations from
dead server backups.

## Roadmap For Portability

The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this specification are to
be interpreted as described in [RFC-2119][].

### 1. Unbundle the services and concerns of a typical instance

1. **Sign everything**: Recognize client-side cryptographic signatures as proof
   of authorship (by implementing [FEP-8b32: Object Integrity Proofs][FEP-8b32]),
   in addition to the current practice of relying solely on the instance URL.

2. **B.Y.O. Actor ID**: Using Object Integrity proofs enables Identity Hosting to
   be separated from the other instance concerns. Actor profiles can now be
   hosted separately from the instance, which in turn enables service providers to offer
   their users a “BYO (Bring Your Own) domain name” feature.

3. **Separate Inbox/Outbox**: (Optional) The previous steps enable message
   transfer and Inbox/Outbox hosting to be outsourced to separate service
   providers (the Actor profile links to these in the usual manner).

4. **Separate Object and Collection hosting**: (Optional) Similarly, AP Objects
   and Collections can now be stored on domains separate from the Actor's domain
   (since authorship and controller-ship can be proven cryptographically, in a
   domain-independent way). This enables the user to migrate storage service
   providers without having to change their Actor ID.

### 2. Implement Portable (migration-stable) Object IDs

Separating the object storage provider from the Actor profile hosting provider
enables the implementation of Object IDs that can remain unchanged through
migrations and export/import cycles. Specifically, we're looking for Object IDs
that remain unchanged even after migrating the objects to be hosted at a different storage
provider.

There are several methods of achieving these types of portable IDs, including:

* [FEP-ef61: Portable Objects](https://codeberg.org/fediverse/fep/src/branch/main/fep/ef61/fep-ef61.md),
  which introduces a new `ap://` URI scheme.
* Actor-Relative URLs (regular `https` URLs that are redirected to their current
  location), specified in [FEP-e3e9: Actor-Relative URLs](https://codeberg.org/fediverse/fep/src/branch/main/fep/e3e9/fep-e3e9.md)
* Various content-based identifier schemes (such as IPFS CIDs)

As long as a user's identity provider's web domain remains constant, they can migrate to
different inbox/outbox and storage providers, without breaking portable links.
That is, users will be able to switch hosting and service providers to different domains,
without breaking signatures, replies and threading, likes, following and followers, or
anything else.

### 3. Create account export/import features that assume Actor-Relative URLs and segmented services

Exporting an account based on this model segments neatly and brings with it
verifiability if each object is separately signed by a key published in the
still-live Actor object.
Importing from such a file is trivial to implement compared to today's account
migrations that need to be aware of the data structures and addressing schemes
of the previous server.

### 4. Enable verifiable Actor URL migration

If the user wants to move their Actor to a different domain, or switch identity
hosting services, a future FEP could define this in a simple,  Verifiable
Credential-style data model containing attestations and proofs that the new
actor is equivalent to the old, controlled by the same subject, etc.
This would generalize and standardize one currently thorny requirement of
interoperable migration, that of authenticating migration requests.

Note: one possible extension of this authentication artefact would be to
incorporate "pre-rotation" style commitments of the sort used in distributed key
management.

### End Result: Stable, migration-aware distributed data

Taken together, these items allow for painless automated migration between
service providers, without broken links or effort duplication, and enables
restoration from backup and thus migration from dead servers.

---

### Step 1: Extract Actor Profile Hosting Into Standalone Service

The first step in unbundling instances is to move out the Actor identity (and
profile hosting) into a standalone service, separate from inbox and object
hosting.

Requirements:

1. Make authorship proofs primarily cryptographic and thus potentially
2. independent of all other services if identity providers and authoring
3. service providers both support client-side signing:
  a. add verification key(s) to the Actor object via
     [FEP-521a](https://codeberg.org/fediverse/fep/src/branch/main/fep/521a/fep-521a.md)
  b. Sign individual activities using the same key(s), as specified in
     [FEP-8b32: Object Integrity Proofs](https://codeberg.org/fediverse/fep/src/branch/main/fep/8b32/fep-8b32.md)
2. Hosting Message Transfer Services (Inbox, Outbox) and special collections
   with side effects (Followers, Following etc) can now be managed separately

#### Example 1: Standalone ActivityPub Actor Profile

Hosted at `https://alice-personal-site.example/actor`

```json
{
  "@context": [
    "https://www.w3.org/ns/activitystreams",
    "https://www.w3.org/ns/did/v1",
    "https://w3id.org/security/multikey/v1"
  ],
  "id": "https://alice-personal-site.example/actor",
  "type": "Person",
  "name": "Alice",
  "preferredUsername": "alice",
  "inbox": "https://service-provider.example/users/alice/inbox",
  "outbox": "https://service-provider.example/users/alice/outbox",
  "assertionMethod": [
     {
       "id": "https://alice-personal-site.example/actor#ed25519-key",
       "type": "Multikey",
       "controller": "https://alice-personal-site.example/actor",
        "publicKeyMultibase": "z6MkrJVnaZkeFzdQyMZu1cgjg7k1pZZ6pvBQ7XJPt4swbTQ2"
     }
  ],
  "service": [{
     "id": "https://alice-personal-site.example/actor#storage",
     "serviceEndpoint": "https://storage-provider.example/users/1234"
  }]
}
```

Things to note:

* The Actor profile's URL is hosted on `https://alice-personal-site.example/actor`,
  but the Inbox and Outbox services are hosted separately, at
  `https://service-provider.example/users/alice/inbox`
* The `assertionMethod` section, as defined in [FEP-521a: Representing actor's
  public keys](https://codeberg.org/fediverse/fep/src/branch/main/fep/521a/fep-521a.md).
* The `service` section, which sets up the ability to use Actor-Relative URLs
  for routing all requests to their current hosts. (This section reuses the
  notation from [Section 5.4 Services of the DID Core Specification](https://www.w3.org/TR/did-core/#services),
  but applies it to non-DID JSON objects in general.) This is described in Step 2
  (below) of the roadmap.

### Step 2: Extract Object and Collection Hosting Into Standalone Service

Given:

* An AP Actor profile that implements [FEP-521a: Representing actor's public keys](https://codeberg.org/fediverse/fep/src/branch/main/fep/521a/fep-521a.md)
* An AP Client that is able to perform [FEP-8b32: Object Integrity Proofs](https://codeberg.org/fediverse/fep/src/branch/main/fep/8b32/fep-8b32.md)
  to sign individual AP Objects and Activities.

These are sufficient pre-requisites to be able to prove authorship or
controller-ship of AP Objects and Activities cryptographically, without
requiring that they are hosted on the same web domain as the Actor's `id` URL.

This means that:

* Object and Collection hosting can now be extracted to general-purpose storage
  providers that are on different domains than the Actor profiles
* Actors can migrate between different storage providers without changing the
  Actor id and url.
* Moderation actions gain additional features for fine-grained handling of
  services distinct from individual objects:
  * Individual Actor IDs can be blocked/moderated, as is currently possible
  * Actor profile providers (in the example above,
    `https://alice-personal-site.example` or `https://example.com/users/alice`)
    can now also be blocked/moderated or accrue reputational weighting
  * Object-hosting or inbox providers (in the example below,
    `https://storage-provider.example`) might also be worth tracking separately
    for some moderation or spam-/sybil-protection use-cases.

### Step 3 (Optional): Extract Inbox Hosting and Message Processing Into Standalone Service

The [ActivityPub specification](https://www.w3.org/TR/activitypub/) already
requires that reserved Collections with special behaviors, such as Inbox, Outbox,
Followers, Following, Liked, etc., MUST all be discoverable through the Actor's
profile. Nothing in the specification precludes each of these special collections
being served on different domains from one another, or from the Actor object itself.

This means that nothing else needs to be changed, at the protocol level, to host
the various special collections on domains different from the Actor profile id's
domain.

Messaging and special collections service providers SHOULD implement the
[ActivityPub C2S (Client to Server)](https://www.w3.org/TR/activitypub/#client-to-server-interactions)
protocol, for maximum client interoperability.

#### Example Actor Profile with External Inbox and Outbox collections

```js
{
  "id": "https://alice-personal-site.example/actor",
  "inbox": "https://service-provider.example/users/alice/inbox",
  "outbox": "https://service-provider.example/users/alice/outbox",
  // …
}
```

### Authentication and Authorization Implications for Steps 2 and 3

Authentication and Authorization considerations for how clients and servers
would interact with externally hosted Objects and Collections is out of scope of
this FEP. Implementers are encouraged to follow current Fediverse best practices,
and use established authorization and authentication mechanisms such as:

* [OAuth 2.0 Authorization Framework](https://datatracker.ietf.org/doc/html/rfc6749) tokens
* [HTTP Signatures][RFC-9421] - [CG Report](https://swicg.github.io/activitypub-http-signature/) in progress
* [Authorization Capabilities for Linked Data](https://w3c-ccg.github.io/zcap-spec/) specification or an
  equivalent capabilities method

## Live and Dead Server Migrations (Keeping Actor ID Constant)

Actor-relative URLs allow for direct export of content to a static file format,
which can be authenticated at time of import with the client-managed key that
also signed the exported content.
Further research could be done on ergonomics, attack vectors, and corner-cases,
but the happy-path flow is quite simple and self-evident once these other changes
have been made.

## Migrating to a Different Actor ID

Web domains are already portable: a user can migrate between different domain
registrars and web hosting providers.

However, we recognize that individual domains are not practical for most of the
world population, due to high yearly domain registration fees and level of knowledge.
We expect that people will instead use actor profiles hosted on free service
providers, either as subdomains (example: `alice.provider.example`) or as paths
(example: `provider.example/users/alice`).

Because of this, Actor IDs (actor profile URLs) must also be portable.
To make this practical and automatable, future research is needed on a Verifiable
Credential-style portable attestation of the equivalence of two Actors, which
avoids requiring Actor Object hosting services to speak enough ActivityPub to
live-authenticate migration requests as currently required by the Move Actor flow.

### Example Actor Equivalence Attestation Object

TODO - possibly in separate FEP. Not strictly needed for the rest of this FEP to
be actionable.

## Appendix A: Current Portability Challenges

In today's implementations reliant on server-specific HTTPS URLs as IDs,
migration of content across servers involves the following steps:
An actor's ID and profile storage location changes, which means
followers/subscribers must be notified of the new identity
For each object that the actor controlled:
the ID of the object changes. (This has knock-on effects for threading,
reactions, moderation decisions, etc.) the storage location changes
authorship changes (knock-on effects for moderation, blocklists, reputation, etc.,
unless ported content makes available prior versions/authors in a standardized
way and/or moderation and reputation systems are made migration-aware)

Additionally, because moderation decisions are currently also tied to an
instance and by themselves are not portable/reusable, content potentially must
be re-moderated at the new instance.
There has been discussion on the Fediverse among people working on moderation
tooling for an abstraction that would help deduplication and track moderation of
objects across migrations, as bad actors tend to take more advantage of any and
all portability affordances than typical users.

## References

* [FEP-521a: Representing actor's public keys][FEP-521a]
* [FEP-73cd: Migration User Stories][FEP-73cd]
* [FEP-8b32: Object Integrity Proofs][FEP-8b32]
* [FEP-cd47: Federation-friendly Addressing and Deduplication Use-Cases][FEP-cd47]

* Christine Lemmer Webber, Jessica Tallon, [ActivityPub][AP], 2018
* S. Bradner, Key words for use in RFCs to Indicate Requirement Levels, 1997
* Dave Longley, Manu Sporny, [Verifiable Credential Data Integrity 1.0][DI for VCs], 2023
* Manu Sporny, Dave Longley, Markus Sabadell, Drummond Reed, Orie Steele,  Christopher Allen, [Decentralized Identifiers][DID] (DIDs) v1.0, 2022
* Dave Longley, Manu Sporny, [Data Integrity EdDSA Cryptosuites][DI Sigs] v1.0, 2023
* A. Rundgren, B. Jordan, S. Erdtman, [JSON Canonicalization Scheme][JCS] (JCS), 2020

[FEP-521a]: https://codeberg.org/fediverse/fep/src/branch/main/fep/521a/fep-521a.md
[FEP-73cd]: https://codeberg.org/fediverse/fep/src/branch/main/fep/73cd/fep-73cd.md#migration-user-stories
[FEP-8b32]: https://codeberg.org/fediverse/fep/src/branch/main/fep/8b32/fep-8b32.md
[FEP-cd47]: https://codeberg.org/fediverse/fep/src/branch/main/fep/cd47/fep-cd47.md

[AP]: https://www.w3.org/TR/activitypub/
[DI Sigs]: https://w3c.github.io/vc-di-eddsa/#eddsa-jcs-2022
[DI for VCs]: https://w3c.github.io/vc-data-integrity/
[DID]: https://www.w3.org/TR/did-core/
[JCS]: https://www.rfc-editor.org/rfc/rfc8785
[RFC-2119]: https://tools.ietf.org/html/rfc2119.html
[RFC-9421]: https://www.rfc-editor.org/rfc/rfc9421

## Copyright

CC0 1.0 Universal (CC0 1.0) Public Domain Dedication

To the extent possible under law, the authors of this Fediverse Enhancement
Proposal have waived all copyright and related or neighboring rights to this work.
